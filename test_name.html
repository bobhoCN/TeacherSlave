<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å§“åè¯†åˆ«æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .console-log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        .test-case {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007aff;
        }
        .test-case h4 {
            margin: 0 0 10px 0;
            color: #007aff;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ“ å§“åè¯†åˆ«åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-section">
        <h2>æµ‹è¯•ç”¨ä¾‹</h2>
        <p>ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹æ¨¡æ‹Ÿäº†ä¸åŒæ ¼å¼çš„å§“åæ ‡æ³¨æ–¹å¼ï¼š</p>

        <div class="test-case">
            <h4>æµ‹è¯•1: æ˜ç¡®æ ‡æ³¨"å§“åï¼š"</h4>
            <pre>å§“åï¼šå¼ ä¸‰</pre>
        </div>

        <div class="test-case">
            <h4>æµ‹è¯•2: æ˜ç¡®æ ‡æ³¨"å­¦ç”Ÿï¼š"</h4>
            <pre>å­¦ç”Ÿï¼šæå››</pre>
        </div>

        <div class="test-case">
            <h4>æµ‹è¯•3: ä½œä¸šé¡¶éƒ¨ç¬¬ä¸€è¡Œ</h4>
            <pre>ç‹å°æ˜
æ•°å­¦ä½œä¸š
ç¬¬ä¸€é¡µ</pre>
        </div>

        <div class="test-case">
            <h4>æµ‹è¯•4: "æˆ‘å«XXX"æ ¼å¼</h4>
            <pre>æˆ‘å«é™ˆå°æ˜ï¼Œä»Šå¤©äº¤ä½œä¸šã€‚</pre>
        </div>

        <div class="test-case">
            <h4>æµ‹è¯•5: "XXXåŒå­¦"æ ¼å¼</h4>
            <pre>å¼ å°æ˜åŒå­¦ï¼š
è¿™æ˜¯æˆ‘çš„ä½œä¸šã€‚</pre>
        </div>

        <div class="test-case">
            <h4>æµ‹è¯•6: è‹±æ–‡æ ‡æ³¨</h4>
            <pre>Name: Wang Wei</pre>
        </div>

        <div class="test-case">
            <h4>æµ‹è¯•7: æ— æ˜ç¡®å§“åæ ‡æ³¨</h4>
            <pre>æ•°å­¦ä½œä¸š
1. è®¡ç®— 100 + 200 = 300
2. è®¡ç®— 50 Ã— 2 = 100</pre>
        </div>

        <button onclick="testNameExtraction()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
    </div>

    <div class="test-section">
        <h2>å®æ—¶æµ‹è¯•</h2>
        <p>è¾“å…¥è‡ªå®šä¹‰æ–‡æœ¬æµ‹è¯•å§“åæå–ï¼š</p>
        <textarea id="testInput" style="width: 100%; height: 100px; padding: 10px; border-radius: 5px; border: 1px solid #ccc;" placeholder="è¾“å…¥åŒ…å«å§“åçš„æ–‡æœ¬..."></textarea>
        <br>
        <button onclick="testSingleInput()">æµ‹è¯•è¾“å…¥æ–‡æœ¬</button>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ç»“æœ</h2>
        <div id="results"></div>
    </div>

    <h2>æ§åˆ¶å°è¾“å‡º</h2>
    <div id="console" class="console-log"></div>

    <script>
        // å¯¼å…¥å§“åæå–å‡½æ•°ï¼ˆä» server.js å¤åˆ¶çš„é€»è¾‘ï¼‰
        function extractStudentName(content) {
            if (!content) return 'æœªçŸ¥';

            const patterns = [
                // æ¨¡å¼1: "å§“åï¼šå¼ ä¸‰" æˆ– "å­¦ç”Ÿï¼šæå››"
                /(?:å§“å|å­¦ç”Ÿ|name|Name)[ï¼š:\s]*([^\n\r,ï¼Œã€‚ã€]+)/i,
                // æ¨¡å¼2: "æˆ‘å«XXX" æˆ– "æˆ‘æ˜¯XXX"
                /(?:æˆ‘å«|æˆ‘æ˜¯|æˆ‘å«åšçš„|æˆ‘å«åš)[ï¼š:\s]*([^\n\r,ï¼Œã€‚ã€]+)/i,
                // æ¨¡å¼3: ç›´æ¥æå–2-4ä¸ªæ±‰å­—ï¼ˆå¸¸è§å§“åï¼‰
                /^\s*([\u4e00-\u9fa5]{2,4})\s*$/m,
                // æ¨¡å¼4: åœ¨æ–‡æœ¬ä¸­æŸ¥æ‰¾å¯èƒ½çš„å§“åï¼ˆå‰åæœ‰æ ‡ç‚¹çš„ï¼‰
                /(?:^|[\s,ï¼Œã€‚ã€])[\s]*([\u4e00-\u9fa5]{2,4})[\s]*(?:$|[\s,ï¼Œã€‚ã€])/,
                // æ¨¡å¼5: æŸ¥æ‰¾"XXXåŒå­¦"æ ¼å¼
                /([\u4e00-\u9fa5]{2,4})åŒå­¦/,
                // æ¨¡å¼6: æŸ¥æ‰¾é¡¶éƒ¨å¯èƒ½çš„å§“åï¼ˆé€šå¸¸åœ¨ç¬¬ä¸€è¡Œå‰å‡ ä¸ªå­—ç¬¦ï¼‰
                /^([\u4e00-\u9fa5]{2,4})/m
            ];

            // å°è¯•æ¯ç§æ¨¡å¼
            for (const pattern of patterns) {
                const match = content.match(pattern);
                if (match && match[1]) {
                    let name = match[1].trim();

                    // è¿‡æ»¤æ‰æ˜æ˜¾çš„éå§“åè¯æ±‡
                    const excludeWords = ['å§“å', 'å­¦ç”Ÿ', 'åå­—', 'name', 'ç­çº§', 'å­¦æ ¡', 'å¹´çº§', 'å§“åï¼š', 'å­¦ç”Ÿï¼š', 'ç¬¬', 'é¢˜', 'é¡µ', 'æ—¥æœŸ'];
                    if (!excludeWords.some(word => name.includes(word))) {
                        // ç¡®ä¿æ˜¯åˆç†çš„å§“åé•¿åº¦
                        if (name.length >= 2 && name.length <= 4) {
                            console.log(`æ¨¡å¼åŒ¹é…æˆåŠŸ: ${pattern} -> ${name}`);
                            return name;
                        }
                    }
                }
            }

            // å¦‚æœæ‰€æœ‰æ¨¡å¼éƒ½å¤±è´¥ï¼Œå°è¯•æå–ç¬¬ä¸€ä¸ªè¿ç»­çš„ä¸­æ–‡è¯
            const chineseMatch = content.match(/[\u4e00-\u9fa5]{2,4}/);
            if (chineseMatch) {
                console.log('ä½¿ç”¨fallbackæå–:', chineseMatch[0]);
                return chineseMatch[0];
            }

            return 'æœªçŸ¥';
        }

        // é‡å†™ console.log
        const originalLog = console.log;
        const consoleDiv = document.getElementById('console');

        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
            consoleDiv.innerHTML += message + '\n';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        function clearConsole() {
            consoleDiv.innerHTML = '';
        }

        function testNameExtraction() {
            console.clear();
            console.log('=== å¼€å§‹å§“åè¯†åˆ«æµ‹è¯• ===\n');

            const tests = [
                { input: 'å§“åï¼šå¼ ä¸‰', expected: 'å¼ ä¸‰', desc: 'æ˜ç¡®æ ‡æ³¨"å§“åï¼š"' },
                { input: 'å­¦ç”Ÿï¼šæå››', expected: 'æå››', desc: 'æ˜ç¡®æ ‡æ³¨"å­¦ç”Ÿï¼š"' },
                { input: 'ç‹å°æ˜\næ•°å­¦ä½œä¸š\nç¬¬ä¸€é¡µ', expected: 'ç‹å°æ˜', desc: 'ä½œä¸šé¡¶éƒ¨ç¬¬ä¸€è¡Œ' },
                { input: 'æˆ‘å«é™ˆå°æ˜ï¼Œä»Šå¤©äº¤ä½œä¸šã€‚', expected: 'é™ˆå°æ˜', desc: '"æˆ‘å«XXX"æ ¼å¼' },
                { input: 'å¼ å°æ˜åŒå­¦ï¼š\nè¿™æ˜¯æˆ‘çš„ä½œä¸šã€‚', expected: 'å¼ å°æ˜', desc: '"XXXåŒå­¦"æ ¼å¼' },
                { input: 'Name: Wang Wei', expected: 'æœªçŸ¥', desc: 'è‹±æ–‡æ ‡æ³¨ï¼ˆé¢„æœŸå¤±è´¥ï¼‰' },
                { input: 'æ•°å­¦ä½œä¸š\n1. è®¡ç®— 100 + 200 = 300', expected: 'æœªçŸ¥', desc: 'æ— æ˜ç¡®å§“åæ ‡æ³¨ï¼ˆé¢„æœŸå¤±è´¥ï¼‰' }
            ];

            let resultsHTML = '<h3>æµ‹è¯•ç»“æœ</h3>';

            tests.forEach((test, index) => {
                console.log(`\n--- æµ‹è¯• ${index + 1}: ${test.desc} ---`);
                console.log(`è¾“å…¥æ–‡æœ¬: "${test.input}"`);

                const result = extractStudentName(test.input);
                const isCorrect = result === test.expected;

                console.log(`æå–ç»“æœ: "${result}"`);
                console.log(`æœŸæœ›ç»“æœ: "${test.expected}"`);
                console.log(`æµ‹è¯•${isCorrect ? 'âœ“ é€šè¿‡' : 'âœ— å¤±è´¥'}`);

                resultsHTML += `
                    <div class="result ${isCorrect ? 'success' : 'error'}">
                        <strong>æµ‹è¯• ${index + 1}: ${test.desc}</strong><br>
                        è¾“å…¥: <code>${test.input}</code><br>
                        æå–ç»“æœ: <strong>${result}</strong><br>
                        æœŸæœ›ç»“æœ: <strong>${test.expected}</strong><br>
                        çŠ¶æ€: ${isCorrect ? 'âœ“ é€šè¿‡' : 'âœ— å¤±è´¥'}
                    </div>
                `;
            });

            document.getElementById('results').innerHTML = resultsHTML;
            console.log('\n=== æµ‹è¯•å®Œæˆ ===');
        }

        function testSingleInput() {
            const input = document.getElementById('testInput').value;
            if (!input) {
                alert('è¯·è¾“å…¥è¦æµ‹è¯•çš„æ–‡æœ¬');
                return;
            }

            console.log('\n=== å®æ—¶æµ‹è¯• ===');
            console.log(`è¾“å…¥æ–‡æœ¬: "${input}"`);

            const result = extractStudentName(input);
            console.log(`æå–ç»“æœ: "${result}"`);

            alert(`æå–çš„å§“å: ${result}`);
        }
    </script>
</body>
</html>