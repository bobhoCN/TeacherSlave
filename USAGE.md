# 数学作业批改系统 - 使用说明

## 📋 快速开始

### 第一次使用

1. **检查系统要求**
   - Windows 10/11 操作系统
   - 安装 Node.js (v14 或更高版本)
   - 现代浏览器 (Chrome、Edge、Firefox)
   - 摄像头（可选，用于拍照功能）

2. **安装 Node.js**
   - 下载地址: https://nodejs.org/
   - 推荐下载 LTS 版本
   - 安装后重启命令提示符

3. **安装依赖**
   ```bash
   npm install
   ```

4. **启动系统**
   ```
   双击 start.bat 文件
   ```

## 🚀 启动流程

当您双击 `start.bat` 时，系统会执行以下操作：

```
[1/3] 检查系统文件...
✓ 检测到系统文件

[2/3] 检查 Node.js...
✓ Node.js 版本: v20.x.x

[3/3] 启动系统...
✓ 启动后端代理服务器...
正在打开浏览器...

✓ 系统已启动
✓ 前端地址: http://localhost:3000/index.html
✓ API地址: http://localhost:3000/api
```

## 📖 详细使用步骤

### 步骤 1: 启动系统

双击 `start.bat` 文件，系统将：

1. 自动检查系统文件
2. 验证 Node.js 是否已安装
3. 启动后端代理服务器
4. 打开浏览器并加载系统主页

### 步骤 2: 选择作业获取方式

系统主页提供两个选项：

#### 选项 A: 拍照批改 📷
- 点击 **"📷 拍照批改"** 按钮
- 系统将请求摄像头权限
- 允许权限后，可以看到实时摄像头画面
- 将作业平整放置在摄像头前
- 点击 **"拍摄作业"** 按钮拍照

#### 选项 B: 上传图片 📁
- 点击 **"📁 上传图片"** 按钮
- 选择以下方式：
  - 点击 **"选择文件"** 从文件对话框选择
  - 直接拖拽图片到上传区域
- 支持格式：JPG、PNG、GIF
- 预览图片后，点击 **"开始批改"**

### 步骤 3: 查看批改进度

系统将显示批改进度页面，包含三个步骤：

1. **识别学生姓名** - 正在提取作业上的学生姓名
2. **提取题目内容** - 正在识别题目和答案
3. **批改评分** - 正在比对答案并计算分数

### 步骤 4: 查看批改结果

批改完成后，系统将显示结果页面：

#### 学生信息
- 显示识别到的学生姓名

#### 题目详情
每道题目包含：
- **题目内容** - 题目原文
- **学生答案** - 学生作答
- **正确答案** - 正确答案
- **对错状态** - ✓ 正确 或 ✗ 错误
- **得分** - 得分/总分

#### 数学公式
系统支持数学公式的渲染，例如：
- 分数：$\frac{1}{2}$
- 指数：$x^2$
- 根号：$\sqrt{2}$
- 积分：$\int_0^1 x dx$

## 🔧 高级功能

### 摄像头操作

#### 切换摄像头（前置/后置）
```javascript
// 在浏览器控制台中执行
switchCamera();
```

#### 获取摄像头状态
```javascript
// 在浏览器控制台中执行
getCameraStatus();
```

### 代理服务器状态检查

在浏览器控制台中检查代理服务状态：
```javascript
// 在浏览器控制台中执行
checkProxyStatus().then(status => {
    console.log('代理服务状态:', status ? '在线' : '离线');
});
```

## ❓ 常见问题

### Q1: 提示"未检测到 Node.js"

**解决方案：**
1. 访问 https://nodejs.org/ 下载并安装 Node.js
2. 选择 LTS 版本（长期支持版）
3. 安装完成后重启命令提示符
4. 验证安装：`node --version`

### Q2: 摄像头无法启动

**解决方案：**
1. 确认摄像头未被其他应用占用
2. 允许浏览器访问摄像头权限
3. 尝试刷新页面（F5）
4. 检查摄像头驱动程序是否最新

### Q3: 识别失败或准确率低

**解决方案：**
1. 确保作业图片清晰
2. 确保学生姓名清晰可见
3. 确保光线充足
4. 避免反光或阴影
5. 使用高分辨率图片

### Q4: 代理服务启动失败

**解决方案：**
1. 检查端口 3000 是否被占用
   ```bash
   netstat -ano | findstr :3000
   ```
2. 手动启动代理服务：
   ```bash
   npm start
   ```
3. 查看错误信息并解决

### Q5: 页面显示空白或加载失败

**解决方案：**
1. 确认代理服务已启动
2. 检查浏览器控制台是否有错误
3. 尝试清除浏览器缓存
4. 尝试其他浏览器

### Q6: 数学公式无法显示

**解决方案：**
1. 确认网络连接正常（需要加载 KaTeX CDN）
2. 检查浏览器是否阻止了 CDN
3. 查看浏览器控制台是否有 KaTeX 加载错误

## 🛠️ 手动操作

### 手动启动代理服务

如果需要手动启动或调试：

```bash
# 进入项目目录
cd /path/to/math-grading-system

# 安装依赖（首次使用）
npm install

# 启动代理服务器
npm start
```

### 手动打开浏览器

如果浏览器没有自动打开：
```
访问: http://localhost:3000/index.html
```

### 查看代理服务状态

```bash
# 检查服务是否运行
curl http://localhost:3000/api/health

# 应该返回：
# {"status":"ok","message":"服务器运行正常"}
```

## 🔐 隐私与安全

### 数据处理
- 所有图片仅在识别时使用，不会上传到第三方存储
- 识别完成后，图片数据不会保存
- API 密钥仅存储在本地代理服务器中

### 网络安全
- 本地代理服务器仅监听本机 (127.0.0.1)
- 不会暴露到公网
- 外部无法访问

## 📝 故障排除流程

1. **确认环境**
   - [ ] Windows 10/11
   - [ ] Node.js 已安装
   - [ ] 现代浏览器

2. **检查服务**
   - [ ] 代理服务是否启动
   - [ ] 端口 3000 是否被占用
   - [ ] 浏览器是否可以访问

3. **检查功能**
   - [ ] 摄像头权限已授权
   - [ ] 图片格式正确
   - [ ] 网络连接正常

4. **查看日志**
   - 打开浏览器开发者工具 (F12)
   - 查看 Console 选项卡中的错误信息

## 📞 技术支持

如果遇到问题无法解决：

1. 查看本使用说明
2. 检查浏览器控制台错误信息
3. 查看代理服务启动日志
4. 记录详细错误信息和操作步骤

## 📚 相关资源

- Node.js 官网: https://nodejs.org/
- Moonshot API 文档: https://platform.moonshot.cn/
- KaTeX 文档: https://katex.org/
- 项目文档: https://github.com/your-repo

---

**版本**: v1.0.0
**更新时间**: 2025-11-09
