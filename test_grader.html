<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>答案比较测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-item {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        .correct {
            background: #d4edda;
            color: #155724;
        }
        .incorrect {
            background: #f8d7da;
            color: #721c24;
        }
        .console-log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>答案比较功能测试</h1>
    <button onclick="runTests()">运行测试</button>
    <button onclick="clearConsole()">清空控制台</button>

    <div id="results"></div>
    <div id="console" class="console-log"></div>

    <script src="assets/js/grader.js"></script>
    <script>
        // 重写 console.log 以显示在页面上
        const originalLog = console.log;
        const consoleDiv = document.getElementById('console');

        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
            consoleDiv.innerHTML += message + '\n';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        function clearConsole() {
            consoleDiv.innerHTML = '';
        }

        function runTests() {
            console.clear();
            console.log('开始测试答案比较功能...\n');

            const tests = [
                // 测试1: 基本数字比较
                { student: '2', correct: '2', description: '基本数字比较' },

                // 测试2: 带空格的答案
                { student: '( -∞ , +∞ )', correct: '(-∞,+∞)', description: '带空格的区间' },

                // 测试3: LaTeX 公式
                { student: '\\frac{1}{2}', correct: '1/2', description: 'LaTeX 分数' },

                // 测试4: 无穷大符号
                { student: '(-∞, ∞)', correct: '(-∞,+∞)', description: '无穷大符号' },

                // 测试5: 相同答案不同表示
                { student: '3.14', correct: '3.140', description: '数值精度' },

                // 测试6: 分数形式
                { student: '1/2', correct: '0.5', description: '分数 vs 小数' },

                // 测试7: 计算过程 vs 结果
                { student: '483 - 333 = 150', correct: '150', description: '计算过程提取结果' },

                // 测试8: 带空格的计算式
                { student: '100 + 50 = 150', correct: '150', description: '计算式（空格）' },

                // 测试9: 乘法计算
                { student: '10 × 10 = 100', correct: '100', description: '乘法计算' }
            ];

            let passed = 0;
            let failed = 0;

            tests.forEach((test, index) => {
                console.log(`\n--- 测试 ${index + 1}: ${test.description} ---`);
                console.log(`学生答案: "${test.student}"`);
                console.log(`正确答案: "${test.correct}"`);

                const result = compareAnswersWithTolerance(test.student, test.correct);

                if (result) {
                    console.log('结果: ✓ 正确');
                    passed++;
                } else {
                    console.log('结果: ✗ 错误');
                    failed++;
                }
            });

            console.log('\n===================================');
            console.log(`测试完成: ${passed} 通过, ${failed} 失败`);
            console.log('===================================');

            // 显示结果摘要
            displayResults(tests);
        }

        function displayResults(tests) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>测试结果</h2>';

            tests.forEach((test, index) => {
                const result = compareAnswersWithTolerance(test.student, test.correct);
                const className = result ? 'correct' : 'incorrect';
                const icon = result ? '✓' : '✗';

                resultsDiv.innerHTML += `
                    <div class="test-item">
                        <strong>测试 ${index + 1}: ${test.description}</strong><br>
                        学生答案: <code>${test.student}</code><br>
                        正确答案: <code>${test.correct}</code><br>
                        <div class="result ${className}">
                            ${icon} ${result ? '正确' : '错误'}
                        </div>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>